FROM node:22-alpine
RUN corepack enable
WORKDIR /app
COPY relay-server/package.json relay-server/tsconfig.json ./
RUN yarn install
COPY relay-server/src ./src
RUN yarn exec tsc
HEALTHCHECK --interval=5s --timeout=3s --retries=10 CMD node -e "const net = require('net'); const s = net.createConnection(9001, '127.0.0.1', () => { s.end(); process.exit(0); }); s.on('error', () => process.exit(1));"
CMD ["node", "dist/index.js"]
